<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>House Points Leaderboard</title>

<style>
@font-face {
  font-family: 'AvallonCaps';
  src: url('https://cdn.jsdelivr.net/gh/NBaker9262/ALA-house-leaderboard/Avallon%20All%20Caps.ttf') format('truetype');
  font-display: swap;
}

:root {
  --bg: #c4a484;
  --grid: rgba(0, 0, 0, 0.08);
  --max-points: 600;
}

/* GENERAL LAYOUT */
html, body {
  height: 100%;
  margin: 0;
  background: var(--bg);
  font-family: Arial, sans-serif;
}

.wrap {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px 40px;
  box-sizing: border-box;
}

/* HEADER */
header {
  text-align: center;
  margin-bottom: 10px;
}

h1 {
  font-family: 'AvallonCaps', Arial, sans-serif;
  font-size: clamp(48px, 6vw, 90px);
  margin: 0;
  color: #000;
  text-transform: uppercase;
  letter-spacing: 2px;
}

/* CHART AREA */
.chart-area {
  display: flex;
  align-items: flex-end;
  justify-content: space-around;
  height: 65vh;
  position: relative;
  padding-bottom: 20px;
}

.y-grid {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

.y-grid .line {
  height: 1px;
  background: var(--grid);
  position: absolute;
  left: 0;
  right: 0;
}
.y-grid .line.l0 { top: 0 }
.y-grid .line.l1 { top: 25% }
.y-grid .line.l2 { top: 50% }
.y-grid .line.l3 { top: 75% }

.bar {
  flex: 1 1 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-end;
  position: relative;
}

/* ANIMAL ICON ABOVE EACH BAR */
.house-icon {
  width: 120px;
  height: auto;
  object-fit: contain;
  position: absolute;
  bottom: calc(100% + 5px);
  transition: bottom 0.9s cubic-bezier(.2,.9,.2,1);
}

/* BAR STYLE */
.bar-inner {
  width: 80%;
  border-radius: 10px;
  min-height: 15vh;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: height 900ms cubic-bezier(.2, .9, .2, 1), background-color 400ms;
  box-shadow: inset 0 2px 3px rgba(0, 0, 0, 0.15);
  position: relative;
  font-weight: bold;
  font-size: clamp(22px, 3.2vw, 40px);
}

/* COLOR SCHEME */
.red { background: #ea0125; color: #fff; }
.white { background: #fffeff; color: #000; }
.blue { background: #005ab5; color: #fff; }
.silver { background: #a7a7aa; color: #000; }

@media(min-width: 1000px) {
  .house-icon { width: 130px; }
}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>House Points Leaderboard</h1>
  </header>

  <div class="chart-area" id="chart">
    <div class="y-grid" aria-hidden="true">
      <div class="line l0"></div>
      <div class="line l1"></div>
      <div class="line l2"></div>
      <div class="line l3"></div>
    </div>

    <div class="bar">
      <img class="house-icon" id="icon-blue" src="https://raw.githubusercontent.com/NBaker9262/ALA-house-leaderboard/refs/heads/main/Grizzly%20%20(blank%20background).png" alt="Blue House">
      <div class="bar-inner blue" id="bar-blue"><div class="score-label" id="score-blue">0</div></div>
    </div>

    <div class="bar">
      <img class="house-icon" id="icon-silver" src="https://raw.githubusercontent.com/NBaker9262/ALA-house-leaderboard/refs/heads/main/Kodiak%20%20(blank%20background).png" alt="Silver House">
      <div class="bar-inner silver" id="bar-silver"><div class="score-label" id="score-silver">0</div></div>
    </div>

    <div class="bar">
      <img class="house-icon" id="icon-red" src="https://raw.githubusercontent.com/NBaker9262/ALA-house-leaderboard/refs/heads/main/Panda%20%20(blank%20background).png" alt="Red House">
      <div class="bar-inner red" id="bar-red"><div class="score-label" id="score-red">0</div></div>
    </div>

    <div class="bar">
      <img class="house-icon" id="icon-white" src="https://raw.githubusercontent.com/NBaker9262/ALA-house-leaderboard/refs/heads/main/Polar%20%20(blank%20background).png" alt="White House">
      <div class="bar-inner white" id="bar-white"><div class="score-label" id="score-white">0</div></div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAAAz2beBA1QnvLPTbaq5LmEnR6m-VvK0s",
    authDomain: "ala-house-leaderboard.firebaseapp.com",
    projectId: "ala-house-leaderboard",
    storageBucket: "ala-house-leaderboard.firebasestorage.app",
    messagingSenderId: "827317744881",
    appId: "1:827317744881:web:c8518ba6523610ab006550",
    measurementId: "G-W47XZ87CQE"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const scoresDoc = doc(db, "leaderboard", "scores");

  const bars = {
    red: document.getElementById('bar-red'),
    white: document.getElementById('bar-white'),
    blue: document.getElementById('bar-blue'),
    silver: document.getElementById('bar-silver'),
  };
  const labels = {
    red: document.getElementById('score-red'),
    white: document.getElementById('score-white'),
    blue: document.getElementById('score-blue'),
    silver: document.getElementById('score-silver'),
  };
  const icons = {
    red: document.getElementById('icon-red'),
    white: document.getElementById('icon-white'),
    blue: document.getElementById('icon-blue'),
    silver: document.getElementById('icon-silver'),
  };

  function setDynamicHeights(values) {
    const maxVal = Math.max(...Object.values(values), 1);
    for (const k in bars) {
      const val = values[k] ?? 0;
      const ratio = val / maxVal;
      const heightVH = 15 + ratio * 45; // dynamically scale all
      bars[k].style.height = heightVH + 'vh';
      icons[k].style.bottom = `calc(${heightVH}vh + 10px)`;
    }
  }

  function updateUI(payload) {
    const vals = {
      red: payload.red ?? 0,
      white: payload.white ?? 0,
      blue: payload.blue ?? 0,
      silver: payload.silver ?? 0
    };

    for (const k in vals) labels[k].textContent = vals[k];
    setDynamicHeights(vals);
  }

  onSnapshot(scoresDoc, (snap) => {
    if (!snap.exists()) return;
    const data = snap.data();
    updateUI(data);

    if (data._confetti && data._confetti.house) {
      const colorMap = { red:'#ea0125', white:'#fffeff', blue:'#005ab5', silver:'#a7a7aa' };
      const color = colorMap[data._confetti.house] || '#ffffff';
      confetti({ particleCount: 100, spread: 60, origin: { y: 0.6 }, colors: [color] });
      confetti({ particleCount: 60, spread: 55, origin: { x: 0, y: 0.8 }, colors: [color], angle: 60 });
      confetti({ particleCount: 60, spread: 55, origin: { x: 1, y: 0.8 }, colors: [color], angle: 120 });
    }
  });
</script>
</body>
</html>
