<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>House Points Leaderboard</title>

<style>
@font-face {
  font-family: 'AvallonCaps';
  src: url('https://cdn.jsdelivr.net/gh/NBaker9262/ALA-house-leaderboard/Avallon%20All%20Caps.ttf') format('truetype');
  font-display: swap;
}

:root {
  --bg: #c4a484;
  --grid: rgba(0, 0, 0, 0.08);
  --gap: 2.4vw; /* midpoint spacing */
  --max-points: 600;
}

html, body {
  height: 100%;
  margin: 0;
  font-family: 'AvallonCaps', Arial, sans-serif;
  background: var(--bg);
}

.wrap {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px 40px;
  box-sizing: border-box;
}

header {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 25px;
  margin-bottom: 5px;
}

h1 {
  font-size: 6vw;
  line-height: 0.9;
  margin: 0;
  letter-spacing: 2px;
  color: #000;
  text-transform: uppercase;
}

.logo {
  width: 130px;
  height: auto;
  object-fit: contain;
  display: block;
}

hr.top {
  border: 0;
  border-top: 2px solid rgba(0, 0, 0, 0.06);
  margin: 8px 0 16px;
}

.chart-area {
  display: flex;
  align-items: flex-end;
  gap: var(--gap);
  height: 62vh;
  padding: 15px 0;
  position: relative;
}

.y-grid {
  position: absolute;
  left: 0;
  right: 0;
  height: 100%;
  pointer-events: none;
}

.y-grid .line {
  height: 1px;
  background: var(--grid);
  position: absolute;
  left: 0;
  right: 0;
}

.y-grid .line.l0 { top: 0 }
.y-grid .line.l1 { top: 25% }
.y-grid .line.l2 { top: 50% }
.y-grid .line.l3 { top: 75% }

.bar {
  flex: 1 1 0;
  display: flex;
  align-items: flex-end;
  justify-content: center;
}

.bar-inner {
  width: 87%; /* midpoint between 90% and 85% */
  border-radius: 1.5px; /* slightly less rounded */
  min-height: 15vh;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: height 900ms cubic-bezier(.2, .9, .2, 1), background-color 400ms;
  box-shadow: inset 0 2px 3px rgba(0, 0, 0, 0.15);
  position: relative;
}

.score-label {
  font-size: clamp(28px, 3.8vw, 52px);
  font-weight: 700;
  color: inherit;
  text-align: center;
  transform: translateY(-10%);
  pointer-events: none;
}

/* house colors */
.red { background: #d90b1e; color: #fff; }
.white { background: #ffffff; color: #000; }
.blue { background: #122b56; color: #fff; }
.silver { background: #d8dbe0; color: #000; }

.bar-inner { height: 15vh; }

@media(min-width: 1000px) {
  h1 { font-size: 80px; }
  .logo { width: 140px; }
  .bar-inner { border-radius: 28px; }
}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>House Points<br>Leaderboard</h1>
    <img class="logo" id="teamLogo" src="https://raw.githubusercontent.com/NBaker9262/Noah-ALA-File-Hosting/refs/heads/main/ALA%20Bear%20No%20BG.png" alt="logo">
  </header>

  <hr class="top">

  <div class="chart-area" id="chart">
    <div class="y-grid" aria-hidden="true">
      <div class="line l0"></div>
      <div class="line l1"></div>
      <div class="line l2"></div>
      <div class="line l3"></div>
    </div>

    <div class="bar"><div class="bar-inner red" id="bar-red"><div class="score-label" id="score-red">0</div></div></div>
    <div class="bar"><div class="bar-inner white" id="bar-white"><div class="score-label" id="score-white">0</div></div></div>
    <div class="bar"><div class="bar-inner blue" id="bar-blue"><div class="score-label" id="score-blue">0</div></div></div>
    <div class="bar"><div class="bar-inner silver" id="bar-silver"><div class="score-label" id="score-silver">0</div></div></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAAAz2beBA1QnvLPTbaq5LmEnR6m-VvK0s",
    authDomain: "ala-house-leaderboard.firebaseapp.com",
    projectId: "ala-house-leaderboard",
    storageBucket: "ala-house-leaderboard.firebasestorage.app",
    messagingSenderId: "827317744881",
    appId: "1:827317744881:web:c8518ba6523610ab006550",
    measurementId: "G-W47XZ87CQE"
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const scoresDoc = doc(db, "leaderboard", "scores");

  const maxPoints = Number(getComputedStyle(document.documentElement).getPropertyValue('--max-points')) || 600;
  const bars = {
    red: document.getElementById('bar-red'),
    white: document.getElementById('bar-white'),
    blue: document.getElementById('bar-blue'),
    silver: document.getElementById('bar-silver'),
  };
  const labels = {
    red: document.getElementById('score-red'),
    white: document.getElementById('score-white'),
    blue: document.getElementById('score-blue'),
    silver: document.getElementById('score-silver'),
  };

  function setBarHeight(el, value) {
    const pct = Math.min(100, (value / maxPoints) * 100);
    el.style.height = (8 + pct * 0.9) + 'vh';
  }

  function updateUI(payload) {
    const r = payload.red ?? 0;
    const w = payload.white ?? 0;
    const b = payload.blue ?? 0;
    const s = payload.silver ?? 0;

    labels.red.textContent = r;
    labels.white.textContent = w;
    labels.blue.textContent = b;
    labels.silver.textContent = s;

    setBarHeight(bars.red, r);
    setBarHeight(bars.white, w);
    setBarHeight(bars.blue, b);
    setBarHeight(bars.silver, s);
  }

  onSnapshot(scoresDoc, (snap) => {
    if (!snap.exists()) return;
    const data = snap.data();
    updateUI(data);

    if (data._confetti && data._confetti.house) {
  const colorMap = { red:'#d90b1e', white:'#ffffff', blue:'#122b56', silver:'#d8dbe0' };
  const color = colorMap[data._confetti.house] || '#ffffff';

  // Heavier burst
  const duration = 3000;
  const end = Date.now() + duration;

  (function frame() {
    confetti({
      particleCount: 180,
      spread: 80,
      startVelocity: 45,
      origin: { y: 0.6 },
      colors: [color],
      scalar: 1.2,
    });
    if (Date.now() < end) requestAnimationFrame(frame);
  })();
}
  });
</script>
</body>
</html>
